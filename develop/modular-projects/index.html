<!DOCTYPE html>
<html lang="en">


<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Modular projects</title>
  <meta name="description" content="The third edition of µOS++, a POSIX inspired open source system, written in C++.">

  <meta property="og:title" content="Modular projects">
  <meta property="og:site_name" content="µOS++ IIIe">

  <link rel="alternate" type="application/rss+xml" title="µOS++ IIIe" href="/feed.xml">


  <meta property="article:published_time" content="2017-09-26">





  <meta name="google-site-verification" content="NT_y3tqI_8mrd8gYA_FDWHT2-tkJExOC6KBkSnyZx6c">

  <link href="https://fonts.googleapis.com/css?family=Architects+Daughter" rel="stylesheet" type="text/css">

  <link rel="stylesheet" type="text/css" href="/stylesheets/screen.css?201608151703" media="screen">
  <link rel="stylesheet" type="text/css" href="/stylesheets/font-awesome.css?201608151703" media="screen">
  <link rel="stylesheet" type="text/css" href="/stylesheets/print.css?201608151703" media="print">

  <link rel="canonical" href="http://micro-os-plus.github.io/develop/modular-projects/">



  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-16767008-14', 'auto');
  ga('send', 'pageview');

</script>



</head>


<body>

<div class="container">

  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.4";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

  <script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>

  <div class="site-header">
  <table style="width:100%">
    <tr>
      <td>
        <a href="/">
          <img alt="Icon" class="site-icon" src="/assets/icons/wall-e-icon.png" height="100" width="100">
      </a>
      </td>
      <td>
        <table class="site-title" style="width:100%">
          <tr>
            <td class="site-title">
              <a href="/">µOS++ IIIe</a>
            </td>
            <td class="site-motto" align="right">
              “Perfekt ist nicht gut genug”
            </td>
          </tr>
          <tr>
            <td class="site-description" colspan="2">
              The third edition of µOS++, a POSIX inspired open source system, written in C++.
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</div>


</div>

<div class="container">

  <div class="wrapper">
    <div class="site-body">

      <div class="site-sidebar">


  <div class="custom-sidebar">
    <div class="boxed-group-inner">
      <h4 id="news"><a href="/blog/">News</a></h4>

<ul>
  <li><a href="/blog/2017/08/26/micro-os-plus-v6-3-13-released/">µOS++ IIIe v6.3.13 released</a></li>
  <li><a href="/blog/2017/01/02/micro-os-plus-v6-3-11-released/">µOS++ IIIe v6.3.11 released</a></li>
  <li><a href="/blog/2016/11/27/micro-os-plus-v6-3-10-released/">µOS++ IIIe v6.3.10 released</a></li>
  <li><a href="/blog/2016/10/13/micro-os-plus-v6-3-9-released/">µOS++ IIIe v6.3.9 released</a></li>
</ul>


    </div>
  </div>


  <div class="custom-sidebar">
    <div class="boxed-group-inner">
      
      <h4 id="home"><a href="/">Home</a></h4>

<h4 id="µos-iiie">µOS++ IIIe</h4>

<ul>
  <li><a href="/micro-os-plus/">Overview</a></li>
</ul>

<h4 id="apis">APIs</h4>

<ul>
  <li><a href="/cmsis-plus/">Overview</a></li>
  <li><a href="/cmsis-plus/rtos/">RTOS API</a></li>
</ul>

<h4 id="xpacksxcdl">xPacks/XCDL</h4>

<ul>
  <li><a href="/xpacks/">Overview</a></li>
</ul>

<h4 id="documentation">Documentation</h4>

<ul>
  <li>
<a href="/user-manual/">User’s <strong>manual</strong></a>
    <ul>
      <li><a href="/user-manual/getting-started/">Getting started</a></li>
      <li><a href="/user-manual/basic-concepts/">Basic concepts</a></li>
      <li><a href="/user-manual/features/">Features</a></li>
      <li><a href="/user-manual/threads/">Threads</a></li>
      <li><a href="/user-manual/thread-event-flags/">Thread event flags</a></li>
      <li><a href="/user-manual/semaphores/">Semaphores</a></li>
      <li><a href="/user-manual/event-flags/">Event flags</a></li>
      <li>Mutexes</li>
      <li>Condition variables</li>
      <li>Message queues</li>
      <li>Memory pools</li>
      <li>Software timers</li>
      <li>Clocks</li>
    </ul>
  </li>
  <li><a href="/reference/cmsis-plus/">µOS++ <strong>reference</strong></a></li>
</ul>

<h4 id="developer">Developer</h4>

<ul>
  <li><a href="/develop/">Overview</a></li>
  <li><a href="/reference/cmsis-plus/md_doxygen_pages_change-log.html">Change log</a></li>
  <li><a href="/develop/coding-style/">C++ coding style</a></li>
  <li><a href="/develop/references/">Links &amp; references</a></li>
</ul>

<h4 id="support">Support</h4>

<ul>
  <li><a href="/support/">Overview</a></li>
  <li><a href="/support/known-issues/">Known issues</a></li>
  <li><a href="/support/faq/">FAQ</a></li>
  <li><a href="/support/forum/">Forum</a></li>
  <li><a href="https://github.com/micro-os-plus/micro-os-plus-iii/issues/">Report µOS++ IIIe issues</a></li>
</ul>

<h4 id="latest-articles">Latest Articles</h4>

<ul>
  <li><a href="/articles/arm-com-2016-06-24/">CMSIS++ RTOS: fully functional reference implementation</a></li>
  <li><a href="/articles/arm-com-2016-03-11/">CMSIS++: a proposal for a future CMSIS, written in C++</a></li>
</ul>

<h4 id="license">License</h4>

<ul>
  <li><a href="https://opensource.org/licenses/MIT">MIT</a></li>
</ul>

<h4 id="about"><a href="/about/">About</a></h4>

    </div>
  </div>

  <div class="site-theme">
    This site uses the <a href="https://github.com/ilg-ul/github-jekyll-theme">GitHub Wiki-like</a> theme by <a href="https://github.com/ilg-ul">Liviu Ionescu</a>.
  </div>

</div>


      <div class="site-content">

        
<h1 class="page-title">Modular projects</h1>
<table id="last-modified">
  <tr>
    <td id="last-modified">Last modified on Tue Sep 26 18:27:54 2017 UTC.</td>
    <td id="improve" align="right"><a id="improve" href="https://github.com/micro-os-plus/micro-os-plus.github.io-source/edit/master/pages/develop/modular-projects.md"><i class="fa fa-pencil"></i>  Improve this page</a></td>
  </tr>
</table>

<div id="toc-container">
<table class="toc" id="toc">
<tbody>
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toc_level-1 toc_section-1">
<a href="#objectives--benefits"><span class="tocnumber">1</span> <span class="toctext">Objectives &amp; benefits</span></a>
<ul>
<li class="toc_level-2 toc_section-2">
<a href="#challanges"><span class="tocnumber">1.1</span> <span class="toctext">Challanges</span></a>
</li>
<li class="toc_level-2 toc_section-3">
<a href="#solution"><span class="tocnumber">1.2</span> <span class="toctext">Solution</span></a>
</li>
<li class="toc_level-2 toc_section-4">
<a href="#benefits"><span class="tocnumber">1.3</span> <span class="toctext">Benefits</span></a>
</li>
</ul>
</li>
<li class="toc_level-1 toc_section-5">
<a href="#project-structure"><span class="tocnumber">2</span> <span class="toctext">Project structure</span></a>
<ul>
<li class="toc_level-2 toc_section-6">
<a href="#application-vs-packages"><span class="tocnumber">2.1</span> <span class="toctext">Application vs packages</span></a>
</li>
<li class="toc_level-2 toc_section-7">
<a href="#example"><span class="tocnumber">2.2</span> <span class="toctext">Example</span></a>
</li>
<li class="toc_level-2 toc_section-8">
<a href="#dependencies"><span class="tocnumber">2.3</span> <span class="toctext">Dependencies</span></a>
</li>
<li class="toc_level-2 toc_section-9">
<a href="#tools"><span class="tocnumber">2.4</span> <span class="toctext">Tools</span></a>
</li>
</ul>
</li>
<li class="toc_level-1 toc_section-10">
<a href="#embedded-projects-specifics"><span class="tocnumber">3</span> <span class="toctext">Embedded projects specifics</span></a>
<ul>
<li class="toc_level-2 toc_section-11">
<a href="#board-vs-device-vs-architecture"><span class="tocnumber">3.1</span> <span class="toctext">Board vs Device vs Architecture</span></a>
</li>
<li class="toc_level-2 toc_section-12">
<a href="#the-startup-code"><span class="tocnumber">3.2</span> <span class="toctext">The startup code</span></a>
</li>
<li class="toc_level-2 toc_section-13">
<a href="#linker-scripts"><span class="tocnumber">3.3</span> <span class="toctext">Linker scripts</span></a>
</li>
<li class="toc_level-2 toc_section-14">
<a href="#tracing-support"><span class="tocnumber">3.4</span> <span class="toctext">Tracing support</span></a>
</li>
</ul>
</li>
<li class="toc_level-1 toc_section-15">
<a href="#demo"><span class="tocnumber">4</span> <span class="toctext">Demo</span></a>
<ul>
<li class="toc_level-2 toc_section-16">
<a href="#eclipse-project-template"><span class="tocnumber">4.1</span> <span class="toctext">Eclipse project template</span></a>
</li>
<li class="toc_level-2 toc_section-17">
<a href="#command-line-template"><span class="tocnumber">4.2</span> <span class="toctext">Command line template</span></a>
</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="objectives--benefits">Objectives &amp; benefits</h2>

<h3 id="challanges">Challanges</h3>

<p>One of the major challanges when developing software is reusing various pieces of code from other applications.</p>

<p>The trivial approach is to simply copy/paste routines or entire files from one application to another. This is ok as long as the code does not change; once this happens, manually updating all projects is no longer trivial.</p>

<p>A slightly better solution is to create separate libraries, and include them <em>as is</em> in different projects. Initially this may look ok, but if the number of libraries grows, and the libraries have inter-dependencies, knowing which libraries are compatible with each other may no longer be as easy as expected.</p>

<p>This problem is agravated by the fact that each library has its own life cycle, and new versions may no longer be compatible with the other libraries.</p>

<h3 id="solution">Solution</h3>

<p>Instead of a monolythic project, where the build processes a complicated folder hierarchy, one possible solution is to build the project from separate components, stored in separate packages.</p>

<p>In practical terms, each package should have, in addition to the source files, some metadata, to define its own identity and a list of dependencies from other packages.</p>

<h3 id="benefits">Benefits</h3>

<p>This modular approach with structured metadata greatly increase the code reusability and upgreadability, by allowing automated tools to bring into the project the required components, and to automatically manage the dependencies, accepting only combinations of compatible packages.</p>

<p>Such solutions are already available for other languages, with the most successful one being <a href="https://www.npmjs.com">npm</a> (The Node Package Manager), for JavaScript modules.</p>

<p>There were also several attempts to create such solutions for C/C++ embedded applications, but they had limited success (for example CMSIS Packs, which uses huge packages and is more or less specific to Keil MDK, and yotta, originally from ARM mbed, but now abandoned, which mandates the use of cmake and python).</p>

<h2 id="project-structure">Project structure</h2>

<h3 id="application-vs-packages">Application vs packages</h3>

<p>In the proposed modular aproach, the application code is clearly separated from the external packages; the application folders are under full control of the user, who can edit/add/remove any files, while the packages are under the control of the package manager, and generally are read only, to prevent inadvertent changes.</p>

<h3 id="example">Example</h3>

<p>An example of such a project structure is used in the <strong>SiFive project templates</strong>; most of the files are part of the application; the packages are grouped below the <code class="highlighter-rouge">xpacks</code> folder, and the package metadata is in <code class="highlighter-rouge">package.json</code>:</p>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="gp">$ </span>tree -L 2 hifive1-blinky
hifive1-blinky
├── LICENSE
├── README.md
├── build
├── include
│   ├── led.h
│   └── sysclock.h
├── ldscripts
│   ├── libs.ld
│   ├── mem.ld
│   └── sections.ld
├── oocd.launch
├── package.json
├── src
│   ├── initialize-hardware.cpp
│   ├── interrupts-handlers.cpp
│   ├── led.cpp
│   ├── main.cpp
│   ├── newlib-syscalls.c
│   └── sysclock.cpp
├── xmake.json
└── xpacks
    ├── micro-os-plus-c-libs
    ├── micro-os-plus-cpp-libs
    ├── micro-os-plus-diag-trace
    ├── micro-os-plus-riscv-arch
    ├── micro-os-plus-startup
    ├── sifive-coreplex-devices
    └── sifive-hifive1-board

38 directories, 61 files
<span class="gp">$ </span>
</code></pre>
</div>

<h3 id="dependencies">Dependencies</h3>

<p>Each package keeps a list of dependencies to other packages, and the package manager ensures that all required packages are downloaded and made available to the project before the build starts.</p>

<p>For the above project, the <code class="highlighter-rouge">package.json</code> file includes the following dependencies:</p>

<div class="language-json highlighter-rouge">
<pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="nt">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"@micro-os-plus/diag-trace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~1.0.1"</span><span class="w">
        </span><span class="p">,</span><span class="nt">"@sifive/hifive1-board"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~0.0.3"</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>In other words, the application requires explicit support only for diagnostics and for the <strong>SiFive HiFive1</strong> board. Inspecting the above project structure, it is easy to identify seven packages, not two. The explanation is that the <code class="highlighter-rouge">sifive-hifive1-board</code> package pulled <code class="highlighter-rouge">sifive-coreplex-devices</code>, which pulled <code class="highlighter-rouge">micro-os-plus-riscv-arch</code>, which pulled <code class="highlighter-rouge">micro-os-plus-startup</code> and the two libraries.</p>

<h3 id="tools">Tools</h3>

<p>To further automate things, packages can refer not only to other source packages, but to tools packages, which include separate applications required during the development cycle, like toolchains, debuggers, builders, etc.</p>

<h2 id="embedded-projects-specifics">Embedded projects specifics</h2>

<h3 id="board-vs-device-vs-architecture">Board vs Device vs Architecture</h3>

<p>TODO: explain each package type, with content, metadata and usage</p>

<h3 id="the-startup-code">The startup code</h3>

<p>TODO: explain the startup sequence and used hooks</p>

<h3 id="linker-scripts">Linker scripts</h3>

<p>TODO: explain the multi-file linker scripts, with configuration</p>

<h3 id="tracing-support">Tracing support</h3>

<p>TODO: explain the need for a separate trace channel, and how to use trace::printf()</p>

<h2 id="demo">Demo</h2>

<h3 id="eclipse-project-template">Eclipse project template</h3>

<ul>
  <li>generate project</li>
  <li>build</li>
</ul>

<h3 id="command-line-template">Command line template</h3>

<ul>
  <li>generate projct</li>
  <li>build with xmake</li>
</ul>









<ul class="share-buttons">
  <li><div class="fb-share-button" data-href="http://micro-os-plus.github.io/develop/modular-projects/" data-layout="button"></div></li>
  <li><div class="tw-share-button"><a href="https://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a></div></li>
</ul>



      </div>

    </div>
  </div>

</div>

<div class="container">

  <div class="site-footer">
  <div class="site-footer-links left">
    <ul>
  <li>© 2017 Liviu Ionescu</li>
  <li>Hosted on GitHub</li>
  <li>
    <p><a href="/feed.xml"><img src="/assets/images/feed-20.png" alt="RSS"></a></p>
  </li>
  <li>
<a href="http://twitter.com/micro_os_plus" class="twitter-follow-button" data-show-count="false">Follow @micro_os_plus</a><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</li>
</ul>


  </div>
  <a href="https://github.com/micro-os-plus/micro-os-plus-iii" aria-label="Homepage">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
  </a>
  <div class="site-footer-links right">
    <ul>
  <li><a href="/">Home</a></li>
  <li><a href="/blog/">News</a></li>
  <li><a href="https://github.com/micro-os-plus/micro-os-plus-iii/releases">Releases</a></li>
  <li><a href="https://github.com/micro-os-plus/micro-os-plus-iii/issues">Support</a></li>
  <li><a href="/about/">About</a></li>
</ul>

  </div>
</div>


</div>

</body>
</html>
